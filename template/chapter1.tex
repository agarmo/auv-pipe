\chapter{Theory}
	
\section{Reference systems}
	Reference systems is an important part of analysis of moving dynamical systems. When one derive the motion of a system one will need some reference fram to calculate the motion relative too. There are a couple of different reference systems used today. One is the ECEF-frame (Earth-Centered, Earth-Fixed), which has the center of the earth as the origin of the frame. The frame rotates with the earth, but when the speed of the vessel is low, this frame can be considered inertial. \cite{forsell}
	
	Another common reference frame are the NED frame (North-East-Down). It is defined as the tangetial plane at the earth's surface moving with the vessel. This frame is not valid for inter-continental travel. It is defined with the x-axis pointing towards the Earth's true north, the y-axis pointing towards the east, and the z-axis pointing downwards toward Earth's center. The NED-frame is defined relative to the ECEF-frame by the means of two angles, \textit{longitude} and \textit{latitude}. This is the global reference system that will be used in this report. \cite{fossen}
	
	The last reference system used is the Body-frame, which all forces, moments, linear velocities and angular velocities will be expressed in. This frame has it's center in the Center of Gravitiy (CG) of the vessel. The x-axis is defined in the logitudinal axis of the vessel, y-axis to the right, and the z-axis is directed downwards to complete the right hand-system. The body-frame values are transformed to the NED-frame by the means of a Rotataion matrix.
	
	
	
	

\section{Hydrodynamic Model}
	An Autonomous Underwater Vehicle is a complex, non-linear and coupled process. The model which is used in this report uses the 6 DOF model described in \cite{fossen}.
		\begin{align}
			\label{eq:chp1-model}
			\mathbf{\dot{\eta}} &= \rotation \mathbf{\nu} \\
			\mass + \coriolis + \damping + \restoring &= \force \\
		\end{align}
	The equations \eqref{eq:chp1-model} describes the kinematics and kinetics for the model. It is in the mathematical sense just a Mass-damper-spring system. The coriolis term, $\mathbf{C}(\mathbf{\nu})$, is a skew-symmetric matrix.
	
	The $\rotation$ matrix is the rotation matrix of euler coordinates which relates the velocity of the vessel to actual movment in the global reference system.




\section{Camera therory}
	Using camera for control is not a stright forward problem. Calculations are needed to relate the data discovered by the camera to the real world which the vessel is opperating in. This imply that coordinates of a 2D point in the camera have to be transformed into a 3D point which can be used by the control system onboard the AUV. Since we are going from less knowledge about a point to more knowledge about a point, some things are needed to be estimated or measured to gain the ability to solve the 2D to 3D problem exactely.
	
	The camera properties or parameters can be devided into two cathegories; the intrinsic parameters and extrinsic parameters. The intrinsic parameters are constant parameters and vary from camera to camera. It is the focus distance and image distortion of the pixels away from the center of the camera. The extrincic parameters relate the position of the point relative to camera coordinates. These parameters are ofcourse dependant on the position of the camera and change with time. \cite{robotbok}
	
	To solve the problem, it is least complicated to look at the velocity of the points in the camera view. The motion of the point in the camera view is then represented in the real world coordinates by a so called interaction matrix. \cite{robotbok}
	\begin{equation}
		\label{eq:ch1-camcord2worldcord}
		\dot{\mathbf{x}}_i = \interaction \mathbf{\nu}
	\end{equation}
	$\mathbf{x}_i$ is the coordinates of the point in image coordinates, $\mathbf{\nu}$ is the linear and angular velocity of the camera in 6 DOFs in this case this is the same velocities as the vessel, since the camera is locked in a fixed position on the AUV. The matrix $\interaction$ is the Interaction matrix. This matrix is a nonlinear combination of intrinsic and extrinsic parameters of the camera, and is dependent on the distance to the point in space.
	
	<<<<<<<<<---------------------->>>>>>>>>>>>>>	
	
	The control problem is to follow the points in the camera image and keep them relatively close to the AUV. This is done by controlling the velocities of the AUV. 

	<<<<<<<<<---------------------->>>>>>>>>>>>>>

\section{Guidance Algorithms}
	The guidance algorithm is one of the most important part of an autonomous vehicles control system. It needs to be robust and be able to handle moast situations. A guidance system should be able to give feasible commands to the lower level control system which controls the actuators, and should be able to handle most situations with care. The guidance system should decide the best trajectory to be followed based on the target location and physical capabilities of the system.\cite{GuidanceReview}

	Most of the guidance algorithms originates from airborne missile systems. This have been well documented and proven to work in numerous cases. Common guidance scheems such as Line-of-sight (LOS) and Proportional Navigation Guidance (PNG) and vareious implementations of these are employed in numerous guidance systems.

	Line-of-sight-guidance are the most common principle used. The LOS-algorithm computes the line-of-sight angle from the present location to the target location, and uses this angle as a reference heading.

	Proportional Navigation Guidance is more effective that LOS-guidance in case of a non-maneuvering target. It gives less interception time than LOS. The PNG-law can be stated as the following: \cite{GuidanceReview}
	\begin{equation}
		\eta_c = N' V_c \dot{\lambda}
	\end{equation}
	where $\eta_c$ is the acceleration command, $N'$ is the navigation ratio, $V_c$ is the closing velocity, and $\dot{\lambda}$ is the line of sight angular velocity. The navigation ratio is a tuning parameter which will give higher demanded acceleration and therby reacing the target in less time.

	These laws does not work so well with maneuvering targets and lots of solutions have been proposed to make these laws more effective when dealing with moving targets. In this case the targets will be non-moving waypoints and the maneuvering laws will not be discussed here.


\section{Kalman Filter}
	Kalman filtering a powerful and versatile tool in estimation and sensor fusion. A Kalman filter is usually employd in navigation applications to fuse GPS and INS together. By this way one will have the speed and resolution of an INS system and the precission of the GPS system. 

	The Kalman Filter is as stated befor a very versatile tool which can be employed allmost in any application. The downside with the Kalman filter is that it is a Linear system, and can only guarantee optimality for linear systems. The system considered in this report is nonlinear and one can not use the Kalman filter directly on this system. There is a nonlinear version of the Kalman filter, the Extended Kalman Filter, which uses the same assumptions as the linear version but uses the nonlinear model to predict the state forward. When updating the Covariance matrix the system equations are linearized around the current estimate and updated according to certain update laws. This introduces some significant problems. First the filter might converge towards wrong values, because of a non-positive-definite covariance matrix. This is mostly due to poor linearization of the state equations. \cite{kalman}
	
	
	

